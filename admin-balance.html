<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Oakline Bank Admin - Update Balance</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f9; }
    h1 { color: #004080; }
    input, select, button { padding: 10px; margin: 5px 0; width: 100%; max-width: 400px; }
    button { background: #004080; color: #fff; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background: #003366; }
    #message, #current-balance { margin-top: 15px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Admin - Update User Balance</h1>

  <label>Email:</label>
  <input type="email" id="email" placeholder="user email" onblur="loadBalance()">

  <div id="current-balance"></div>

  <label>Action:</label>
  <select id="action">
    <option value="set">Set Balance</option>
    <option value="adjust">Deposit/Withdraw</option>
  </select>

  <label>Amount:</label>
  <input type="number" id="amount" placeholder="Amount (positive or negative)">

  <button onclick="submitBalance()">Submit</button>

  <div id="message"></div>

  <script>
    const emailInput = document.getElementById("email");
    const balanceDisplay = document.getElementById("current-balance");
    const messageDisplay = document.getElementById("message");

    // Load current balance
    async function loadBalance() {
      const email = emailInput.value.trim();
      if (!email) return;

      try {
        const response = await fetch(`/api/update-balance?email=${encodeURIComponent(email)}`);
        const result = await response.json();

        if (response.ok) {
          balanceDisplay.innerText = `üí∞ Current Balance: $${result.balance || 0}`;
        } else {
          balanceDisplay.innerText = `‚ùå ${result.message || "User not found"}`;
        }
      } catch (err) {
        balanceDisplay.innerText = "‚ùå Error loading balance";
        console.error(err);
      }
    }

    // Submit balance update
    async function submitBalance() {
      const email = emailInput.value.trim();
      const action = document.getElementById("action").value;
      const amount = parseFloat(document.getElementById("amount").value);

      if (!email || isNaN(amount)) {
        messageDisplay.innerText = "‚ùå Please fill in valid email and amount.";
        return;
      }

      try {
        const response = await fetch("/api/update-balance", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, action, amount })
        });

        const result = await response.json();

        if (response.ok) {
          messageDisplay.innerText = `‚úÖ Balance updated! New Balance: $${result.user.balance}`;
          loadBalance(); // refresh displayed balance
        } else {
          messageDisplay.innerText = `‚ùå ${result.message || "Failed to update balance."}`;
        }
      } catch (err) {
        console.error(err);
        messageDisplay.innerText = "‚ùå Error updating balance.";
      }
    }
  </script>
</body>
</html>

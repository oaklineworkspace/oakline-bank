<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Oakline Bank - Signup</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
  body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 50px; text-align: center; }
  .container { background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.1); max-width: 600px; margin: auto; text-align: left; }
  input, select, button { width: 100%; padding: 10px; margin: 8px 0; font-size: 16px; }
  button { background: #007bff; color: #fff; border: none; cursor: pointer; }
  button:hover { background: #0056b3; }
  h2, h3 { text-align: center; }
  .account-types { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
</style>
</head>
<body>

<div class="container">
<h2>Oakline Bank Signup</h2>

<form id="signupForm">
  <h3>Personal Information</h3>
  <input type="text" id="firstName" placeholder="First Name" required>
  <input type="text" id="middleName" placeholder="Middle Name (Optional)">
  <input type="text" id="lastName" placeholder="Last Name" required>
  <input type="date" id="dob" required>
  <input type="text" id="ssn" placeholder="SSN (XXX-XX-XXXX)" pattern="\d{3}-\d{2}-\d{4}" required>
  <input type="text" id="maidenName" placeholder="Mother's Maiden Name" required>
  <input type="text" id="address" placeholder="Address" required>
  <input type="text" id="city" placeholder="City" required>
  <input type="text" id="state" placeholder="State/Province" required>
  <input type="text" id="zip" placeholder="Zip / Postal Code" pattern="\d{5}" required>
  <select id="country" required>
    <option value="">Select Country</option>
    <option value="US">United States</option>
    <option value="CA">Canada</option>
    <option value="GB">United Kingdom</option>
    <option value="AU">Australia</option>
  </select>
  <input type="email" id="email" placeholder="Email" required>
  <input type="tel" id="phone" placeholder="Phone Number" required>
  <input type="password" id="password" placeholder="Password" required>

  <h3>Account Types</h3>
  <div class="account-types">
    <label><input type="checkbox" value="checking" checked> Checking</label>
    <label><input type="checkbox" value="savings" checked> Savings</label>
    <label><input type="checkbox" value="money_market"> Money Market</label>
    <label><input type="checkbox" value="cd"> Certificate of Deposit (CD)</label>
    <label><input type="checkbox" value="joint"> Joint Account</label>
    <label><input type="checkbox" value="credit"> Credit Line</label>
    <label><input type="checkbox" value="investment"> Investment / Brokerage</label>
  </div>

  <button type="submit">Sign Up</button>
</form>
</div>

<script>
  const supabase = supabase.createClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
  );

  const ROUTING_NUMBER = '075915826';

  function generateOaklineAccountNumber(type) {
    let prefix = '';
    switch(type) {
      case 'checking': prefix = '01'; break;
      case 'savings': prefix = '02'; break;
      case 'money_market': prefix = '03'; break;
      case 'cd': prefix = '04'; break;
      case 'joint': prefix = '05'; break;
      case 'credit': prefix = '06'; break;
      case 'investment': prefix = '07'; break;
    }
    return prefix + Math.floor(10000000 + Math.random() * 90000000).toString();
  }

  document.getElementById('signupForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const personalInfo = {
      first_name: document.getElementById('firstName').value,
      middle_name: document.getElementById('middleName').value,
      last_name: document.getElementById('lastName').value,
      dob: document.getElementById('dob').value,
      ssn: document.getElementById('ssn').value,
      maiden_name: document.getElementById('maidenName').value,
      address: document.getElementById('address').value,
      city: document.getElementById('city').value,
      state: document.getElementById('state').value,
      zip: document.getElementById('zip').value,
      country: document.getElementById('country').value,
      email: document.getElementById('email').value,
      phone: document.getElementById('phone').value,
      password: document.getElementById('password').value,
      routing_number: ROUTING_NUMBER
    };

    const accountTypesChecked = Array.from(document.querySelectorAll('.account-types input[type=checkbox]:checked'))
      .map(input => input.value);

    const accounts = {};
    accountTypesChecked.forEach(type => {
      accounts[type + '_account_number'] = generateOaklineAccountNumber(type);
      accounts[type + '_balance'] = 1000; // initial balance
    });

    const { data, error } = await supabase
      .from('oakline_accounts')
      .insert([{ ...personalInfo, ...accounts }]);

    if (error) {
      alert('Error creating account: ' + error.message);
      return;
    }

    alert('Welcome to Oakline Bank! Your accounts have been created.\nRouting Number: ' + ROUTING_NUMBER);

    window.location.href = process.env.NEXT_PUBLIC_SITE_URL + '/login.html';
  });
</script>

</body>
</html>
